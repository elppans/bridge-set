# Maintainer: Marcelo K. <marcelo.pdvtec@gmail.com>
# shellcheck disable=all

pkgname=bridge-set
pkgver=1.0.9
pkgrel=5
arch=('any')
license=('CUSTOM')
depends=('iproute2' 'networkmanager' 'bridge-utils' 'dhclient')
optdepends=('dhcpcd')
pkgdesc="Cria uma ponte de rede (bridge) para combinar várias interfaces em uma única conexão."
url="https://github.com/elppans/${pkgname}"
source=("git+${url}.git")
#sha256sums=("ceb19612672b5ddf98a7965f88fb0b0c214c85ba23122135fe9d164590fcad42"
#	# "76b652d916d91243990d6e571b389ae73438637ecf42a66ef481833613d88716"
#	"63e8dabd4ca7fd583ce931ea9d93ab783e2dbba8f52d47e186d48d283bbf630c")
sha256sums=(SKIP)

package() {
	# Criação dos diretórios necessários
	#cd "${srcdir}"
	mkdir -p "${pkgdir}/usr/bin"
	mkdir -p "${pkgdir}/opt/${pkgname}"
	mkdir -p "${pkgdir}/etc/systemd/system"

	# Instalação dos arquivos em seus respectivos diretórios
	#install -m0755 $srcdir/${pkgname} "${pkgdir}/opt/${pkgname}/${pkgname}"
	#ln -sf "$pkgdir/opt/$pkgname/$pkgname" "$pkgdir/usr/bin/$pkgname"
	install -m0755 "$srcdir/${pkgname}/${pkgname}"							  "${pkgdir}/usr/bin/${pkgname}"
	install -m0644 "$srcdir/${pkgname}/${pkgname}.conf.pacnew"	  "${pkgdir}/opt/${pkgname}/${pkgname}.conf.pacnew"
	install -m0644 "$srcdir/${pkgname}/${pkgname}.service.pacnew" "${pkgdir}/etc/systemd/system/${pkgname}.service"
}

post_install() {
	systemctl daemon-reload
	cat <<-EOF
O bridge-set foi instalado com sucesso...
Faça o comando "bridge-set" sem parametros para ver o help;
Para mais informações, acesse o README no github.
EOF

	# Caminho para o arquivo bridge-set.conf
	bridgesetconf="/opt/bridge-set/bridge-set.conf"
	bridgesetconfnew="/opt/bridge-set/bridge-set.conf.pacnew"

	# Verifica se o arquivo existe
	if [ -f "${bridgesetconf}" ]; then
		echo "warning: ${bridgesetconf} installed as ${bridgesetconfnew}"
	else
		# Renomeia o novo arquivo para o nome original
		mv "${bridgesetconfnew}" "${bridgesetconf}"
	fi
}

post_upgrade() {
	post_install
}

post_remove() {
	echo "O $pkgname foi removido"
}
